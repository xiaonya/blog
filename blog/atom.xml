<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://xiaonya.github.io/blog</id>
    <title>xiaonya Blog</title>
    <updated>2026-01-01T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="http://xiaonya.github.io/blog"/>
    <subtitle>xiaonya Blog</subtitle>
    <icon>http://xiaonya.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[2025 年终总结]]></title>
        <id>http://xiaonya.github.io/blog/2026-01-01-2025-summary</id>
        <link href="http://xiaonya.github.io/blog/2026-01-01-2025-summary"/>
        <updated>2026-01-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[2025 年回顾：经历和成长的一年，记录点滴，展望未来。]]></summary>
        <content type="html"><![CDATA[<p>2025 年回顾：经历和成长的一年，记录点滴，展望未来。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="目录">目录<a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E7%9B%AE%E5%BD%95" class="hash-link" aria-label="Direct link to 目录" title="Direct link to 目录" translate="no">​</a></h3>
<ul>
<li class=""><a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E7%9B%AE%E5%BD%95" class="">目录</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E5%89%8D%E8%A8%80" class="">前言</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E5%B9%B4%E5%88%9D%E6%8A%89%E6%8B%A9" class="">年初抉择</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1" class="">毕业设计</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E5%88%9D%E5%85%A5%E8%81%8C%E5%9C%BA" class="">初入职场</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E8%BD%AE%E5%B2%97%E6%97%B6%E9%97%B4" class="">轮岗时间</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E6%80%BB%E7%BB%93" class="">总结</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E7%AB%8B%E4%B8%8Bflag" class="">立下flag</a></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="前言">前言<a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E5%89%8D%E8%A8%80" class="hash-link" aria-label="Direct link to 前言" title="Direct link to 前言" translate="no">​</a></h3>
<p>发现很多的朋友都写了一篇年终报告，无论是否学习了很多知识，达成了很多目标。虽然我过去并没有这个习惯，但今年发生了很多事情，也从学生转变为了社畜，觉得为了自己，也可以跟风写个回顾总结。不过我的文笔并不是很好，只是突然有些表达欲</p>
<blockquote>
<p><del>尽管人类从历史中学到的唯一教训，就是人类没有从历史中学到任何教训</del> :3</p>
</blockquote>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="年初抉择">年初抉择<a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E5%B9%B4%E5%88%9D%E6%8A%89%E6%8B%A9" class="hash-link" aria-label="Direct link to 年初抉择" title="Direct link to 年初抉择" translate="no">​</a></h3>
<p>2025 年年初，我面临了一个重要的抉择：因为我同时收到了小米和家附近一家银行的秋招offer。小米薪资高点，但离家远离学校近，而银行薪资低但WLB，而且离家近，在咨询了了几位我认为比我思考层级更深的朋友后，我得到了的结果是：</p>
<ul>
<li class="">朋友A，在上海实习时遇到的同济，新国立大哥，用人力资源的理论算出来的结果认为家附近的银行其实与小米的薪资差距并没有想象中那么大，毕竟小米的生活成本更高，也离家远，没什么资源能调配</li>
<li class="">朋友B，济南金融老登，认为WLB更重要，毕竟他自己就在尝试朝着更好的WLB去转型</li>
<li class="">朋友C，波斯顿大学留学的朋友，认为小米的发展潜力更大</li>
</ul>
<p>综合考虑后，我还是选择了家附近的银行，放弃了小米1.5倍的薪资。但是从现在半年后的视角来看，我还不能下结论这个选择是对还是错。。。。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="毕业设计">毕业设计<a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E6%AF%95%E4%B8%9A%E8%AE%BE%E8%AE%A1" class="hash-link" aria-label="Direct link to 毕业设计" title="Direct link to 毕业设计" translate="no">​</a></h3>
<p>2025 年上半年还在做毕业设计，这段时间应该是大学时期编程掌握的最好的一段时间了，学着别人的项目，自己也跟着搓，说不定是自己第一次接触开源项目的代码。</p>
<blockquote>
<p><del>学习别人的小巧思，制作自己的大构思</del> XD</p>
</blockquote>
<p>诶，但该说不说，感觉自己选的项目还是挺不赖的，难度适中，架构也不复杂，属于编程水平入门慢慢看也能看懂的程度，这段时间没有课程任务，纯自己学习做事，中途还跟朋友去了上海，去了南京4年都没去过的一些地方玩，回来还顺便把驾照一次拿到手了，这段时间感觉像是人生中最后一段惬意又充实的时光。</p>
<p>最后的毕业答辩倒是挺简短的，介绍完架构，原理，功能后，老师们一句听不懂就放我下去了，好尴尬，不过也算是完成了任务。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="初入职场">初入职场<a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E5%88%9D%E5%85%A5%E8%81%8C%E5%9C%BA" class="hash-link" aria-label="Direct link to 初入职场" title="Direct link to 初入职场" translate="no">​</a></h3>
<p>中间休息了两周后，7月份入职银行，开始慢慢熟悉工作环境和内容。刚开始的几个月主要是培训和适应期，学习运维的基础知识和操作规范，过去自己的摸索东西野路子比较多，现在开始重新系统地学习一些专业知识，不得不说，感觉跟同届新员工相比还是挺有优势的，经验比他们要多不少。实际上需要重新系统学习的东西可能还是以K8S为主，其他其实都多少接触过了。</p>
<p>工作内容主要是日常的运维任务，包括新的项目上线，日常都是些删数，查数以及系统变更的任务，倒是没有太多技术含量的东西，更多的是流程和规范。整个操作过程很繁琐，还会有风险管理的同事来复核，方案外的操作都会导致合规问题，有点烦人。公司里很多系统都是直接找供应商来做的，自己内部开发的东西很少，感觉技术含量不高，让人提不起兴趣。可能我还是更喜欢能够自己尝试去做运维开发的工作吧。</p>
<p>公司的福利待遇不错，一日三餐都很便宜，同事们都很友好，经常请客聚餐，老板也比较开明，给了我很多学习和发展的机会。虽然工作内容有些单调，但我还是学到了很多新的知识和技能，尤其是在大型系统的运维和管理方面。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="轮岗时间">轮岗时间<a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E8%BD%AE%E5%B2%97%E6%97%B6%E9%97%B4" class="hash-link" aria-label="Direct link to 轮岗时间" title="Direct link to 轮岗时间" translate="no">​</a></h3>
<p>年底开始了轮岗，我先是去了底下基层网点轮岗，同事们人都很好，但工作体验一言难尽。基层网点的工作内容主要是面对客户，处理各种业务和问题，感觉和我之前的工作内容差别很大。每天都要接待很多客户，处理各种复杂的业务和问题，有时候还会遇到一些棘手的情况，根本处理不了。</p>
<p>基层的柜员们既辛苦又无奈，顶层的领导们在设计各种制度和流程时，根本没有考虑到基层的实际情况，导致很多制度和流程都不切实际，给基层带来了很大的压力和负担。但是直面客户的又是柜员们，直接承受着客户的抱怨和不满，这种矛盾让人感到很无力。</p>
<p>在网点轮岗结束后，又去了一级支行的设备管理岗轮岗，这个岗位主要职责就是维护底下所有网点的计算机、打印机和网络设备。因为我之前大学时曾在社团连续两年对校内同学提供免费的设备维修服务，所以这份工作对我来说轻松又愉快，我在这干的很起劲也很开心，不得不说，这份工作说不定才是真的能让我好好工作，快乐社会的坑位。因为柜员们下班后，我们也就下班了，因此这份工作有着我喜欢的内容，又有着银行的上下班时间，简直完美。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="总结">总结<a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结" translate="no">​</a></h3>
<p>2025 年的关键程度几乎跟高考年不相上下，就业方向的选择让我重新回到了自己家，开始了新的生活方式和工作节奏。但至于这个选择到底是对还是错，我还不能下定论，或许还需要更多的时间去观察和体验，而反事实思维也让我时不时会去思考，如果当初选择了小米，现在的生活又会是怎样的？</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="立下flag">立下flag<a href="http://xiaonya.github.io/blog/2026-01-01-2025-summary#%E7%AB%8B%E4%B8%8Bflag" class="hash-link" aria-label="Direct link to 立下flag" title="Direct link to 立下flag" translate="no">​</a></h3>
<p>2026 年再立几个flag吧：</p>
<ul class="contains-task-list containsTaskList_mC6p">
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->减肥，要求不高，但是得减点，至少一年得瘦个10斤吧</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->把Go语言拾回来，工作之后荒了很久，一直没写过编程语言</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->深入一下K8S，工作上用的比较多，而且会涉及到内部原理</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->学一下ebpf，感觉工作上会用得上的</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->ebpf接触了，Linux底层也得学了，但暂时还不知道学习路径应该怎么安排</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->平时有空也能再学学之前玩的网安，好玩</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->游戏还是可以偶尔玩玩的，但时间应该会少了</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->可以的话，再多写点博客，记录一下学习和生活</li>
<li class="task-list-item"><input type="checkbox" disabled=""> <!-- -->公司需要的话可能还得考考证啥的，等需要了再说:3</li>
</ul>]]></content>
        <author>
            <name>xiaonya</name>
            <uri>https://blog.xiaonya.com</uri>
        </author>
        <category label="daily-life" term="daily-life"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[天钡小主机CPU故障排查记录]]></title>
        <id>http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure</id>
        <link href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure"/>
        <updated>2025-12-30T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[记录一次比较少见的天钡mini主机CPU硬件故障排查过程。]]></summary>
        <content type="html"><![CDATA[<p>记录一次比较少见的天钡mini主机CPU硬件故障排查过程。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="目录">目录<a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E7%9B%AE%E5%BD%95" class="hash-link" aria-label="Direct link to 目录" title="Direct link to 目录" translate="no">​</a></h2>
<ul>
<li class=""><a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E7%9B%AE%E5%BD%95" class="">目录</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E8%83%8C%E6%99%AF%E4%B8%8E%E5%BC%82%E5%B8%B8%E7%8E%B0%E8%B1%A1" class="">背景与异常现象</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E5%88%9D%E6%AD%A5%E5%B0%9D%E8%AF%95%E6%8E%92%E9%99%A4%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%8E%E7%B3%BB%E7%BB%9F%E9%97%AE%E9%A2%98" class="">初步尝试：排除虚拟化与系统问题</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E6%B7%B1%E5%85%A5%E6%8E%92%E6%9F%A5%E6%A0%A1%E9%AA%8C%E5%92%8C%E5%BC%82%E5%B8%B8" class="">深入排查：校验和异常</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E6%95%85%E9%9A%9C%E5%AE%9A%E4%BD%8Dcpu%E6%9F%90%E6%A0%B8%E5%BF%83%E6%95%85%E9%9A%9C" class="">故障定位：CPU某核心故障</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%86%B3%E4%B8%8E%E5%90%8E%E7%BB%AD" class="">临时解决与后续</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="背景与异常现象">背景与异常现象<a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E8%83%8C%E6%99%AF%E4%B8%8E%E5%BC%82%E5%B8%B8%E7%8E%B0%E8%B1%A1" class="hash-link" aria-label="Direct link to 背景与异常现象" title="Direct link to 背景与异常现象" translate="no">​</a></h2>
<p><img decoding="async" loading="lazy" alt="天钡主机" src="http://xiaonya.github.io/assets/images/IMG_20260103_141331_903-da20a9a136334a1c9c71c16198d5249c.jpg" width="720" height="558" class="img_ev3q"></p>
<p>前几天终于有空了，于是尝试在自己买的二手天钡miniPC上重装一套家里云的系统，但是重装完之后发现Proxmox VE系统根本无法往虚拟机中正常安装系统。后续即使不用虚拟化也会出现问题，遂开始尝试排查。最初是在proxmox VE中安装虚拟机时，安装媒介的检查会失败，Fedora绕过安装媒介检查安装后无法完整走完安装流程，Debian安装过程可能kernal panic。可能正常通过，但安装完后虚拟机的apt包管理工具明显不正常，更新过程中总是会提示apt cache文件损坏，哈希不正确，无法安装。</p>
<p><img decoding="async" loading="lazy" alt="apt异常" src="http://xiaonya.github.io/assets/images/IMG_20260103_141342_444-954435018827153677fbbdb27685a20d.jpg" width="678" height="608" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="初步尝试排除虚拟化与系统问题">初步尝试：排除虚拟化与系统问题<a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E5%88%9D%E6%AD%A5%E5%B0%9D%E8%AF%95%E6%8E%92%E9%99%A4%E8%99%9A%E6%8B%9F%E5%8C%96%E4%B8%8E%E7%B3%BB%E7%BB%9F%E9%97%AE%E9%A2%98" class="hash-link" aria-label="Direct link to 初步尝试：排除虚拟化与系统问题" title="Direct link to 初步尝试：排除虚拟化与系统问题" translate="no">​</a></h2>
<p>最初怀疑是proxmox VE的问题，尝试升级proxmox VE版本，重新安装proxmox VE，均无效，便放弃虚拟机了。后续尝试在物理机上直接安装Fedora，安装过程中出现的问题与虚拟机中的完全相同，安装Debian也能跑通安装程序，但出现相同的aptcache损坏问题。</p>
<p>当时还怀疑是这套硬件与Linux不兼容，安装Windows后一切正常，但在Windows里的VMware Workstation中安装Linux虚拟机时也会出现相同的问题，进一步排除了Linux兼容性问题。后续尝试使用memtest86对内存进行测试，一切正常，测试全部pass，再在安装的Debian中使用smartctl对硬盘进行检测，也没有发现问题。硬盘健康度100%。</p>
<p>temp</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="深入排查校验和异常">深入排查：校验和异常<a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E6%B7%B1%E5%85%A5%E6%8E%92%E6%9F%A5%E6%A0%A1%E9%AA%8C%E5%92%8C%E5%BC%82%E5%B8%B8" class="hash-link" aria-label="Direct link to 深入排查：校验和异常" title="Direct link to 深入排查：校验和异常" translate="no">​</a></h2>
<p>事情的转机出现在我将shell交给了我的朋友turbo，他也测试了同样的结果，但他通过apt的debug模式发现，确实是文件的校验和不符合要求，于是他用sha256sum对下载的文件进行多次计算，发现文件计算的哈希结果有时候是正确的，有时候是错误的，且错误的结果并不总是相同的。</p>
<p><img decoding="async" loading="lazy" alt="哈希错误" src="http://xiaonya.github.io/assets/images/IMG_20260103_141425_169-db354871d192493ee782d4a9e6af4e3f.jpg" width="1059" height="562" class="img_ev3q"></p>
<p>继续深一步排错发现，哪怕文件已经放入/dev/shm这种内存文件系统中，计算出来的哈希值依然会不稳定，说明问题并不在硬盘上。</p>
<p><img decoding="async" loading="lazy" alt="内存排查" src="http://xiaonya.github.io/assets/images/IMG_20260103_141435_480-5aa03d9f17dc4ed15d6787ea6454b030.jpg" width="1159" height="359" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="故障定位cpu某核心故障">故障定位：CPU某核心故障<a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E6%95%85%E9%9A%9C%E5%AE%9A%E4%BD%8Dcpu%E6%9F%90%E6%A0%B8%E5%BF%83%E6%95%85%E9%9A%9C" class="hash-link" aria-label="Direct link to 故障定位：CPU某核心故障" title="Direct link to 故障定位：CPU某核心故障" translate="no">​</a></h2>
<p>但是内存测试又是通过的，那么继续深入，turbo想到了使用指定CPU核心来进行计算，结果发现当指定某些核心时，计算结果总是错误的，而指定其他核心时，计算结果总是正确的，这下终于锁定问题在CPU上了。检查了AMD的CPU微码更新，微码是正常的。</p>
<p><img decoding="async" loading="lazy" alt="单核心计算" src="http://xiaonya.github.io/assets/images/IMG_20260103_141436_916-4524a8431778a4ce387285906f17f882.jpg" width="1142" height="899" class="img_ev3q"></p>
<p>脚本如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">c</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">seq</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">0</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable number" style="color:#36acaa">15</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain">   </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"core </span><span class="token string variable" style="color:#36acaa">$c</span><span class="token string" style="color:#e3116c">"</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:#36acaa">i</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"> taskset </span><span class="token parameter variable" style="color:#36acaa">-c</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$c</span><span class="token plain"> sha256sum /dev/shm/big</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="临时解决与后续">临时解决与后续<a href="http://xiaonya.github.io/blog/2025-12-30-TianBeiCPUFailure#%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%86%B3%E4%B8%8E%E5%90%8E%E7%BB%AD" class="hash-link" aria-label="Direct link to 临时解决与后续" title="Direct link to 临时解决与后续" translate="no">​</a></h2>
<p>最终，使用在Linux内核参数中禁用了有问题的CPU核心，系统一切恢复正常，apt包管理工具也不再报错。
<img decoding="async" loading="lazy" alt="禁用有问题核心后" src="http://xiaonya.github.io/assets/images/IMG_20260103_141439_849-acc4dabee2527b5064d02fe641b01003.jpg" width="870" height="617" class="img_ev3q"></p>
<p>由于这台电脑是二手🐴上淘的，因此只能联系卖家帮忙走售后进行返修维保。至此，问题将交给天钡的售后来处理，静待结果。</p>]]></content>
        <author>
            <name>xiaonya</name>
            <uri>https://blog.xiaonya.com</uri>
        </author>
        <category label="errors" term="errors"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[K8S 安装详细步骤记录]]></title>
        <id>http://xiaonya.github.io/blog/2025-11-09-K8SInstall</id>
        <link href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall"/>
        <updated>2025-11-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[记录初学K8S时的安装步骤以及踩到的坑，供自己和他人参考。]]></summary>
        <content type="html"><![CDATA[<p>记录初学K8S时的安装步骤以及踩到的坑，供自己和他人参考。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="目录">目录<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#%E7%9B%AE%E5%BD%95" class="hash-link" aria-label="Direct link to 目录" title="Direct link to 目录" translate="no">​</a></h2>
<ul>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#k8s-%E5%AE%89%E8%A3%85%E8%AE%B0%E5%BD%95" class="">K8S 安装记录</a>
<ul>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#%E7%9B%AE%E5%BD%95" class="">目录</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#%E7%9B%AE%E6%A0%87" class="">目标</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#%E7%8E%AF%E5%A2%83" class="">环境</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4" class="">详细步骤</a>
<ul>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#1-%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83" class="">1. 准备环境</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#2-%E5%AE%89%E8%A3%85containerd%E8%BF%90%E8%A1%8C%E6%97%B6" class="">2. 安装containerd运行时</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#3-%E9%85%8D%E7%BD%AEcontainerd" class="">3. 配置containerd</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#4-%E5%AE%89%E8%A3%85kubeadmkubeletkubectl" class="">4. 安装kubeadm、kubelet、kubectl</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#5-%E5%88%9D%E5%A7%8B%E5%8C%96master%E8%8A%82%E7%82%B9" class="">5. 初始化master节点</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#6-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6calico" class="">6. 安装网络插件calico</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#7-%E5%8A%A0%E5%85%A5worker%E8%8A%82%E7%82%B9" class="">7. 加入worker节点</a></li>
<li class=""><a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#8-%E6%A3%80%E6%9F%A5%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81" class="">8. 检查集群状态</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="目标">目标<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#%E7%9B%AE%E6%A0%87" class="hash-link" aria-label="Direct link to 目标" title="Direct link to 目标" translate="no">​</a></h2>
<p>手工建立k8s集群，使用containerd作为容器运行时，calico作为网络插件，coredns作为dns服务，etcd作为集群存储。</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="环境">环境<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#%E7%8E%AF%E5%A2%83" class="hash-link" aria-label="Direct link to 环境" title="Direct link to 环境" translate="no">​</a></h2>
<ul>
<li class="">Fedora 42</li>
<li class="">Linux 6.16.8-200.fc42.x86_64</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="详细步骤">详细步骤<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4" class="hash-link" aria-label="Direct link to 详细步骤" title="Direct link to 详细步骤" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-准备环境">1. 准备环境<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#1-%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83" class="hash-link" aria-label="Direct link to 1. 准备环境" title="Direct link to 1. 准备环境" translate="no">​</a></h3>
<ul>
<li class="">关闭swap，开启内核ip转发</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1.关闭 swap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> swapoff </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/ swap / s/^\(.*\)$/#\1/g'</span><span class="token plain"> /etc/fstab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Fedora系统还需要关闭zram swap，其他系统不清楚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参考 FedoraDisableSWAP.md</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2.加载内核模块</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> modprobe overlay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> modprobe br_netfilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3.设置内核参数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">|</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation function" style="color:#d73a49">sudo</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation function" style="color:#d73a49">tee</span><span class="token string bash punctuation" style="color:#393A34"> /etc/sysctl.d/k8s.conf</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.bridge.bridge-nf-call-ip6tables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.bridge.bridge-nf-call-iptables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">net.ipv4.ip_forward = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sysctl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--system</span><br></span></code></pre></div></div>
<ul>
<li class="">关闭防火墙和selinux</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl disable </span><span class="token parameter variable" style="color:#36acaa">--now</span><span class="token plain"> firewalld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> setenforce </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'s/^SELINUX=enforcing$/SELINUX=disabled/'</span><span class="token plain"> /etc/selinux/config</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-安装containerd运行时">2. 安装containerd运行时<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#2-%E5%AE%89%E8%A3%85containerd%E8%BF%90%E8%A1%8C%E6%97%B6" class="hash-link" aria-label="Direct link to 2. 安装containerd运行时" title="Direct link to 2. 安装containerd运行时" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> dnf </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> containerd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--now</span><span class="token plain"> containerd</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-配置containerd">3. 配置containerd<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#3-%E9%85%8D%E7%BD%AEcontainerd" class="hash-link" aria-label="Direct link to 3. 配置containerd" title="Direct link to 3. 配置containerd" translate="no">​</a></h3>
<ul>
<li class="">生成默认配置文件</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /etc/containerd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> containerd config default </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/containerd/config.toml</span><br></span></code></pre></div></div>
<ul>
<li class="">修改配置文件/etc/containerd/config.toml</li>
<li class="">不能直接在文件尾部添加内容，需要找到对应位置进行修改，确认不存在才能直接添加</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. 使用SystemdCgroup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参考https://github.com/containerd/containerd/blob/main/docs/cri/config.md#cgroup-driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugins.</span><span class="token string" style="color:#e3116c">'io.containerd.cri.v1.runtime'</span><span class="token plain">.containerd.runtimes.runc.options</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  SystemdCgroup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. 配置阿里云镜像源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参考1. https://github.com/containerd/containerd/blob/main/docs/cri/registry.md</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参考2. https://bychannel.github.io/containerd%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 参考3. https://help.aliyun.com/zh/acr/user-guide/accelerate-the-pulls-of-docker-official-images</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 需要自己确定containerd的版本号，接下来以containerd 2.x为例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 在cri配置文件中添加如下内容，指定镜像加速地址文件夹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">plugins.</span><span class="token string" style="color:#e3116c">"io.containerd.cri.v1.images"</span><span class="token plain">.registry</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   config_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"/etc/containerd/certs.d"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建文件夹</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> /etc/containerd/certs.d/docker.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建加速地址文件,该文件地址暂未找到官方文档说明</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 建议直接根据参考2创建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重启containerd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl restart containerd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-安装kubeadmkubeletkubectl">4. 安装kubeadm、kubelet、kubectl<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#4-%E5%AE%89%E8%A3%85kubeadmkubeletkubectl" class="hash-link" aria-label="Direct link to 4. 安装kubeadm、kubelet、kubectl" title="Direct link to 4. 安装kubeadm、kubelet、kubectl" translate="no">​</a></h3>
<ul>
<li class="">添加kubernetes源</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 参考https://mirrors.ustc.edu.cn/help/kubernetes.html#yum</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 执行如下命令（注意修改为自己需要的版本号）：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">|</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation function" style="color:#d73a49">sudo</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation function" style="color:#d73a49">tee</span><span class="token string bash punctuation" style="color:#393A34"> /etc/yum.repos.d/kubernetes.repo</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[kubernetes]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">name=Kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">baseurl=https://mirrors.ustc.edu.cn/kubernetes/core:/stable:/v1.34/rpm/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.34/rpm/repodata/repomd.xml.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果需要使用 CRI-O，执行以下命令：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">|</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation function" style="color:#d73a49">tee</span><span class="token string bash punctuation" style="color:#393A34"> /etc/yum.repos.d/cri-o.repo</span><span class="token string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">[cri-o]</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">name=CRI-O</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">baseurl=https://mirrors.ustc.edu.cn/kubernetes/addons:/cri-o:/stable:/v1.32/rpm/</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.32/rpm/repodata/repomd.xml.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span><br></span></code></pre></div></div>
<ul>
<li class="">安装kubeadm、kubelet、kubectl</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> dnf </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> kubelet kubeadm kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--now</span><span class="token plain"> kubelet</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-初始化master节点">5. 初始化master节点<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#5-%E5%88%9D%E5%A7%8B%E5%8C%96master%E8%8A%82%E7%82%B9" class="hash-link" aria-label="Direct link to 5. 初始化master节点" title="Direct link to 5. 初始化master节点" translate="no">​</a></h3>
<blockquote>
<p>可以提前使用kubeadm config images list命令查看需要拉取的镜像，然后使用ctr命令提前拉取
一般来说指定镜像源后应该不会卡了，拉取的相关说明需要参考第6步的说明。</p>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> kubeadm init --image-repository registry.aliyuncs.com/google_containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 此处可能会卡在以下这种情况</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># [kubelet-check] Waiting for a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 这种情况往往是kubectl没有启动成功,无法验证安装是否成功，可以使用下面的命令查看kubelet日志,定位问题</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> journalctl </span><span class="token parameter variable" style="color:#36acaa">-xeu</span><span class="token plain"> kubelet </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 修好问题后执行以下命令重试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> kubeadm reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> kubeadm init --image-repository registry.aliyuncs.com/google_containers</span><br></span></code></pre></div></div>
<ul>
<li class="">初始化流程结束后配置kubectl</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-p</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/.kube</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> /etc/kubernetes/admin.conf </span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">id</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-u</span><span class="token variable" style="color:#36acaa">)</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">id</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable parameter variable" style="color:#36acaa">-g</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/.kube/config</span><br></span></code></pre></div></div>
<ul>
<li class="">集群信息获取</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看安装的k8s版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看集群信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cluster-info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看各种组件版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get api-versions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看组件状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get componentstatuses</span><br></span></code></pre></div></div>
<ul>
<li class="">检查系统pod状态</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看所有命名空间的pod状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#36acaa">-A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看指定命名空间的pod状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果看到有些pod状态非Running，可以使用下面的命令查错</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pod </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">pod名称</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">命名空间</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<ul>
<li class="">将所有节点标记为可调度</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 处理以下警告使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Warning&nbsp; FailedScheduling&nbsp; 41s (x2 over 6m5s)&nbsp; default-scheduler&nbsp; 0/1 nodes are available: 1 node(s) had untolerated taint {node.kubernetes.io/not-ready: }. no new claims to deallocate, preemption: 0/1 nodes are available: 1 Preemption is not helpful for scheduling.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl taint nodes </span><span class="token parameter variable" style="color:#36acaa">--all</span><span class="token plain"> node-role.kubernetes.io/master-</span><br></span></code></pre></div></div>
<blockquote>
<p>在未安装网络插件前，pods和coredns的状态可能不是Ready和Running，这是正常的，将在下一步安装网络插件后解决。</p>
</blockquote>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-安装网络插件calico">6. 安装网络插件calico<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#6-%E5%AE%89%E8%A3%85%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6calico" class="hash-link" aria-label="Direct link to 6. 安装网络插件calico" title="Direct link to 6. 安装网络插件calico" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> https://docs.projectcalico.org/manifests/calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 接着使用第5步的检查系统pod状态指令，确认网络插件正常工作，且node状态为Ready，才算是集群正常工作</span><br></span></code></pre></div></div>
<blockquote>
<p>此处新手常遇到的问题是镜像未生效，containerd的操作方式与docker有所区别，接下来介绍如何使用ctr命令查看和拉取镜像。</p>
</blockquote>
<p>需要注意的几点：</p>
<ul>
<li class="">在ctr中存在命名空间的区分，默认使用的命名空间是default，而<strong>k8s使用的命名空间是k8s.io</strong>，所以想要查看k8s的镜像需要指定-n参数</li>
<li class="">ctr命令不会自动使用镜像源，需要指定–hosts-dir=/etc/containerd/certs.d</li>
<li class="">想要自动使用镜像源，可以使用crictl命令拉取</li>
<li class="">如果要确定此命令是否真的使用了镜像加速，可以增加–debug=true参数</li>
<li class="">ctr命令存在使用image的简写i的使用方式</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看所有镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ctr </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">镜像地址</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> images list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 拉取镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ctr </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> k8s.io images pull </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">镜像地址</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 例如拉取coredns的镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctr i pull --hosts-dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/containerd/certs.d docker.io/calico/cni:v3.25.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ctr i pull --hosts-dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc/containerd/certs.d registry.k8s.io/sig-storage/csi-provisioner:v3.5.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看k8s.io命名空间下的所有镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> ctr </span><span class="token parameter variable" style="color:#36acaa">-n</span><span class="token plain"> k8s.io i </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 使用crictl拉取镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> crictl pull </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">镜像地址</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-加入worker节点">7. 加入worker节点<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#7-%E5%8A%A0%E5%85%A5worker%E8%8A%82%E7%82%B9" class="hash-link" aria-label="Direct link to 7. 加入worker节点" title="Direct link to 7. 加入worker节点" translate="no">​</a></h3>
<p>正常完成前面的1-4步后，master节点已经可以正常工作了，接下来需要将worker节点加入集群，woker节点的1-4步操作与master节点相同，完成后执行以下操作：</p>
<ul>
<li class="">在master节点上获取新的token以及加入命令</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm token create --print-join-command</span><br></span></code></pre></div></div>
<ul>
<li class="">在worker节点上执行获取到的命令</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> kubeadm </span><span class="token function" style="color:#d73a49">join</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">master节点IP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">:6443 </span><span class="token parameter variable" style="color:#36acaa">--token</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">token</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> --discovery-token-ca-cert-hash sha256:</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">hash值</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 例kubeadm join 192.168.0.62:6443 --token 8vm7ed.o0c8hd1sni050ujg --discovery-token-ca-cert-hash sha256:913eb08165815807a28e5b11b3d5c9f16541d4dc9cf36079e1d2ceed54690832</span><br></span></code></pre></div></div>
<ul>
<li class="">token相关命令</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm token list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 创建新的token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm token create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 删除token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm token delete </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">token</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="8-检查集群状态">8. 检查集群状态<a href="http://xiaonya.github.io/blog/2025-11-09-K8SInstall#8-%E6%A3%80%E6%9F%A5%E9%9B%86%E7%BE%A4%E7%8A%B6%E6%80%81" class="hash-link" aria-label="Direct link to 8. 检查集群状态" title="Direct link to 8. 检查集群状态" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods </span><span class="token parameter variable" style="color:#36acaa">-A</span><br></span></code></pre></div></div>
<ul>
<li class="">如果需要删除集群，使用以下命令</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> kubeadm reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rf</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$HOME</span><span class="token plain">/.kube</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl disable </span><span class="token parameter variable" style="color:#36acaa">--now</span><span class="token plain"> kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> dnf remove </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> kubelet kubeadm kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> dnf remove </span><span class="token parameter variable" style="color:#36acaa">-y</span><span class="token plain"> containerd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl disable </span><span class="token parameter variable" style="color:#36acaa">--now</span><span class="token plain"> containerd</span><br></span></code></pre></div></div>]]></content>
        <author>
            <name>xiaonya</name>
            <uri>https://blog.xiaonya.com</uri>
        </author>
        <category label="K8S" term="K8S"/>
        <category label="containerd" term="containerd"/>
        <category label="getting-started" term="getting-started"/>
        <category label="tutorial" term="tutorial"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[彻底禁用 Fedora 系统的 SWAP 和 ZRAM]]></title>
        <id>http://xiaonya.github.io/blog/2025-11-08-DisableSWAP</id>
        <link href="http://xiaonya.github.io/blog/2025-11-08-DisableSWAP"/>
        <updated>2025-11-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[K8S安装时需要禁用 SWAP，否则会报错。Fedora 默认启用了 ZRAM 作为 SWAP 的一种形式。本文记录一下彻底禁用 Fedora 系统的 SWAP 和 ZRAM的过程]]></summary>
        <content type="html"><![CDATA[<p>K8S安装时需要禁用 SWAP，否则会报错。Fedora 默认启用了 ZRAM 作为 SWAP 的一种形式。本文记录一下彻底禁用 Fedora 系统的 SWAP 和 ZRAM的过程</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="彻底禁用-zram-和-swap">彻底禁用 ZRAM 和 Swap<a href="http://xiaonya.github.io/blog/2025-11-08-DisableSWAP#%E5%BD%BB%E5%BA%95%E7%A6%81%E7%94%A8-zram-%E5%92%8C-swap" class="hash-link" aria-label="Direct link to 彻底禁用 ZRAM 和 Swap" title="Direct link to 彻底禁用 ZRAM 和 Swap" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> swapoff </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /etc/systemd/zram-generator.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /usr/lib/systemd/zram-generator.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl status systemd-zram-setup@zram0.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 屏蔽 ZRAM 启动服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl mask systemd-zram-setup@zram0.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重新加载 systemd 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 再次禁用 swap 以防万一</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> swapoff </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 确认 swap 已禁用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">swapon</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--show</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">free</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<blockquote>
<p>重启后禁用失败，可能在 /etc/systemd/zram-generator.conf 没有创建配置文件来覆盖默认设置。系统正在使用 /usr/lib/systemd/zram-generator.conf 这个默认配置文件。</p>
</blockquote>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 创建配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> /etc/systemd/zram-generator.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 编辑文件并添加配置，设置大小为 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"[zram0]"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> /etc/systemd/zram-generator.conf </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"zram-size = 0"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tee</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> /etc/systemd/zram-generator.conf </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /etc/systemd/zram-generator.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 输出应为：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># [zram0]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># zram-size = 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重新加载 systemd 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 停止 ZRAM setup 服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl stop systemd-zram-setup@zram0.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 再次临时关闭所有 swap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> swapoff </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 检查 Swap 状态，确保当前已关闭</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">free</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">swapon</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--show</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 如果没有输出，表示 swap 已成功禁用</span><br></span></code></pre></div></div>]]></content>
        <author>
            <name>xiaonya</name>
            <uri>https://blog.xiaonya.com</uri>
        </author>
        <category label="Fedora" term="Fedora"/>
        <category label="SWAP" term="SWAP"/>
        <category label="ZRAM" term="ZRAM"/>
        <category label="tutorial" term="tutorial"/>
    </entry>
</feed>