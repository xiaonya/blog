"use strict";(globalThis.webpackChunkblog=globalThis.webpackChunkblog||[]).push([[8130],{7735:n=>{n.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"2025-11-09-K8SInstall","metadata":{"permalink":"/blog/2025-11-09-K8SInstall","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-11-09-K8SInstall/K8SInstallMannal.md","source":"@site/blog/2025-11-09-K8SInstall/K8SInstallMannal.md","title":"K8S \u5b89\u88c5\u8be6\u7ec6\u6b65\u9aa4\u8bb0\u5f55","description":"\u8bb0\u5f55\u521d\u5b66K8S\u65f6\u7684\u5b89\u88c5\u6b65\u9aa4\u4ee5\u53ca\u8e29\u5230\u7684\u5751\uff0c\u4f9b\u81ea\u5df1\u548c\u4ed6\u4eba\u53c2\u8003\u3002","date":"2025-11-09T00:00:00.000Z","tags":[{"inline":false,"label":"K8S","permalink":"/blog/tags/k8s","description":"Kubernetes tag description"},{"inline":false,"label":"containerd","permalink":"/blog/tags/containerd","description":"containerd tag description"},{"inline":false,"label":"calico","permalink":"/blog/tags/calico","description":"calico tag description"},{"inline":false,"label":"kubeadm","permalink":"/blog/tags/kubeadm","description":"kubeadm tag description"},{"inline":false,"label":"getting-started","permalink":"/blog/tags/getting-started","description":"getting-started tag description"},{"inline":false,"label":"tutorial","permalink":"/blog/tags/tutorial","description":"tutorial tag description"}],"readingTime":6.45,"hasTruncateMarker":true,"authors":[{"name":"xiaonya","title":"Operations Engineer","url":"https://blog.xiaonya.com","page":{"permalink":"/blog/authors/xiaonya"},"socials":{"github":"https://github.com/xiaonya"},"imageURL":"https://avatars.githubusercontent.com/u/96672580?s=96&v=4","key":"xiaonya"}],"frontMatter":{"slug":"2025-11-09-K8SInstall","title":"K8S \u5b89\u88c5\u8be6\u7ec6\u6b65\u9aa4\u8bb0\u5f55","authors":"xiaonya","tags":["K8S","containerd","calico","kubeadm","getting-started","tutorial"]},"unlisted":false},"content":"\u8bb0\u5f55\u521d\u5b66K8S\u65f6\u7684\u5b89\u88c5\u6b65\u9aa4\u4ee5\u53ca\u8e29\u5230\u7684\u5751\uff0c\u4f9b\u81ea\u5df1\u548c\u4ed6\u4eba\u53c2\u8003\u3002\\n\x3c!-- truncate --\x3e\\n\\n# K8S \u5b89\u88c5\u8bb0\u5f55\\n## \u76ee\u6807\\nk8s\u96c6\u7fa4\uff0c\u4f7f\u7528containerd\u4f5c\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\uff0ccalico\u4f5c\u4e3a\u7f51\u7edc\u63d2\u4ef6\uff0ccoredns\u4f5c\u4e3adns\u670d\u52a1\uff0cetcd\u4f5c\u4e3a\u96c6\u7fa4\u5b58\u50a8\u3002\\n## \u73af\u5883\\nFedora 42 \\\\\\nLinux 6.16.8-200.fc42.x86_64\\n## \u57fa\u672c\u601d\u8def\\n1. \u51c6\u5907\u73af\u5883\\n2. \u5b89\u88c5containerd\\n3. \u914d\u7f6ectr\u914d\u7f6e\u4ee5\u53ca\u955c\u50cf\u6e90\\n4. \u5b89\u88c5kubeadm\u3001kubelet\u3001kubectl\\n5. \u521d\u59cb\u5316master\u8282\u70b9\\n6. \u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6calico\\n7. \u52a0\u5165worker\u8282\u70b9\\n8. \u68c0\u67e5\u96c6\u7fa4\u72b6\u6001\\n\\n## \u8be6\u7ec6\u6b65\u9aa4\\n### 1. \u51c6\u5907\u73af\u5883\\n- \u5173\u95edswap\uff0c\u5f00\u542f\u5185\u6838ip\u8f6c\u53d1\\n```bash\\n# 1.\u5173\u95ed swap\\nsudo swapoff -a\\nsudo sed -i \'/ swap / s/^\\\\(.*\\\\)$/#\\\\1/g\' /etc/fstab\\n# Fedora\u7cfb\u7edf\u8fd8\u9700\u8981\u5173\u95edzram swap\uff0c\u5176\u4ed6\u7cfb\u7edf\u4e0d\u6e05\u695a\\n# \u53c2\u8003 FedoraDisableSWAP.md\\n\\n\\n# 2.\u52a0\u8f7d\u5185\u6838\u6a21\u5757\\nsudo modprobe overlay\\nsudo modprobe br_netfilter\\n\\n# 3.\u8bbe\u7f6e\u5185\u6838\u53c2\u6570\\ncat <<EOF | sudo tee /etc/sysctl.d/k8s.conf\\nnet.bridge.bridge-nf-call-ip6tables = 1\\nnet.bridge.bridge-nf-call-iptables = 1\\nnet.ipv4.ip_forward = 1\\nEOF\\n\\nsudo sysctl --system\\n```\\n- \u5173\u95ed\u9632\u706b\u5899\u548cselinux\\n```bash\\nsudo systemctl disable --now firewalld\\nsudo setenforce 0\\nsudo sed -i \'s/^SELINUX=enforcing$/SELINUX=disabled/\' /etc/selinux/config\\n```\\n### 2. \u5b89\u88c5containerd\u8fd0\u884c\u65f6\\n```bash\\nsudo dnf install -y containerd\\nsudo systemctl enable --now containerd\\n```\\n### 3. \u914d\u7f6econtainerd\\n- \u751f\u6210\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\\n```bash\\nsudo mkdir -p /etc/containerd\\nsudo containerd config default | sudo tee /etc/containerd/config.toml\\n```\\n- \u4fee\u6539\u914d\u7f6e\u6587\u4ef6/etc/containerd/config.toml\\n- \u4e0d\u80fd\u76f4\u63a5\u5728\u6587\u4ef6\u5c3e\u90e8\u6dfb\u52a0\u5185\u5bb9\uff0c\u9700\u8981\u627e\u5230\u5bf9\u5e94\u4f4d\u7f6e\u8fdb\u884c\u4fee\u6539\uff0c\u786e\u8ba4\u4e0d\u5b58\u5728\u624d\u80fd\u76f4\u63a5\u6dfb\u52a0\\n```bash\\n# 1. \u4f7f\u7528SystemdCgroup\\n# \u53c2\u8003https://github.com/containerd/containerd/blob/main/docs/cri/config.md#cgroup-driver\\nversion = 3\\n[plugins.\'io.containerd.cri.v1.runtime\'.containerd.runtimes.runc.options]\\n  SystemdCgroup = true\\n  \\n# 2. \u914d\u7f6e\u963f\u91cc\u4e91\u955c\u50cf\u6e90\\n# \u53c2\u80031. https://github.com/containerd/containerd/blob/main/docs/cri/registry.md\\n# \u53c2\u80032. https://bychannel.github.io/containerd%E9%85%8D%E7%BD%AE%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F/\\n# \u53c2\u80033. https://help.aliyun.com/zh/acr/user-guide/accelerate-the-pulls-of-docker-official-images\\n# \u9700\u8981\u81ea\u5df1\u786e\u5b9acontainerd\u7684\u7248\u672c\u53f7\uff0c\u63a5\u4e0b\u6765\u4ee5containerd 2.x\u4e3a\u4f8b\\n# \u5728cri\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff0c\u6307\u5b9a\u955c\u50cf\u52a0\u901f\u5730\u5740\u6587\u4ef6\u5939\\n[plugins.\\"io.containerd.cri.v1.images\\".registry]\\n   config_path = \\"/etc/containerd/certs.d\\"\\n# \u521b\u5efa\u6587\u4ef6\u5939\\nsudo mkdir -p /etc/containerd/certs.d/docker.io\\n# \u521b\u5efa\u52a0\u901f\u5730\u5740\u6587\u4ef6,\u8be5\u6587\u4ef6\u5730\u5740\u6682\u672a\u627e\u5230\u5b98\u65b9\u6587\u6863\u8bf4\u660e\\n# \u5efa\u8bae\u76f4\u63a5\u6839\u636e\u53c2\u80032\u521b\u5efa\\n\\n# \u91cd\u542fcontainerd\\nsudo systemctl restart containerd\\n\\n```\\n\\n### 4. \u5b89\u88c5kubeadm\u3001kubelet\u3001kubectl\\n- \u6dfb\u52a0kubernetes\u6e90\\n```bash\\n# \u53c2\u8003https://mirrors.ustc.edu.cn/help/kubernetes.html#yum\\n# \u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff08\u6ce8\u610f\u4fee\u6539\u4e3a\u81ea\u5df1\u9700\u8981\u7684\u7248\u672c\u53f7\uff09\uff1a\\ncat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\\n[kubernetes]\\nname=Kubernetes\\nbaseurl=https://mirrors.ustc.edu.cn/kubernetes/core:/stable:/v1.34/rpm/\\nenabled=1\\ngpgcheck=1\\ngpgkey=https://pkgs.k8s.io/core:/stable:/v1.34/rpm/repodata/repomd.xml.key\\nEOF\\n# \u5982\u679c\u9700\u8981\u4f7f\u7528 CRI-O\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a\\ncat <<EOF | tee /etc/yum.repos.d/cri-o.repo\\n[cri-o]\\nname=CRI-O\\nbaseurl=https://mirrors.ustc.edu.cn/kubernetes/addons:/cri-o:/stable:/v1.32/rpm/\\nenabled=1\\ngpgcheck=1\\ngpgkey=https://pkgs.k8s.io/core:/stable:/v1.32/rpm/repodata/repomd.xml.key\\nEOF\\n```\\n- \u5b89\u88c5kubeadm\u3001kubelet\u3001kubectl\\n```bash\\nsudo dnf install -y kubelet kubeadm kubectl\\nsudo systemctl enable --now kubelet\\n```\\n\\n\\n### 5. \u521d\u59cb\u5316master\u8282\u70b9\\n> \u53ef\u4ee5\u63d0\u524d\u4f7f\u7528kubeadm config images list\u547d\u4ee4\u67e5\u770b\u9700\u8981\u62c9\u53d6\u7684\u955c\u50cf\uff0c\u7136\u540e\u4f7f\u7528ctr\u547d\u4ee4\u63d0\u524d\u62c9\u53d6\\n> \u4e00\u822c\u6765\u8bf4\u6307\u5b9a\u955c\u50cf\u6e90\u540e\u5e94\u8be5\u4e0d\u4f1a\u5361\u4e86\uff0c\u62c9\u53d6\u7684\u76f8\u5173\u8bf4\u660e\u9700\u8981\u53c2\u8003\u7b2c6\u6b65\u7684\u8bf4\u660e\u3002\\n```bash\\nsudo kubeadm init --image-repository registry.aliyuncs.com/google_containers\\n# \u6b64\u5904\u53ef\u80fd\u4f1a\u5361\u5728\u4ee5\u4e0b\u8fd9\u79cd\u60c5\u51b5\\n# [kubelet-check] Waiting for a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s\\n# \u8fd9\u79cd\u60c5\u51b5\u5f80\u5f80\u662fkubectl\u6ca1\u6709\u542f\u52a8\u6210\u529f,\u65e0\u6cd5\u9a8c\u8bc1\u5b89\u88c5\u662f\u5426\u6210\u529f\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770bkubelet\u65e5\u5fd7,\u5b9a\u4f4d\u95ee\u9898\\nsudo journalctl -xeu kubelet -n 50\\n# \u4fee\u597d\u95ee\u9898\u540e\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\u91cd\u8bd5\\nsudo kubeadm reset\\nsudo kubeadm init --image-repository registry.aliyuncs.com/google_containers\\n```\\n- \u521d\u59cb\u5316\u6d41\u7a0b\u7ed3\u675f\u540e\u914d\u7f6ekubectl\\n```bash\\nmkdir -p $HOME/.kube\\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\\n```\\n\\n- \u96c6\u7fa4\u4fe1\u606f\u83b7\u53d6\\n```bash\\n# \u67e5\u770b\u5b89\u88c5\u7684k8s\u7248\u672c\\nkubectl version\\n# \u67e5\u770b\u96c6\u7fa4\u4fe1\u606f\\nkubectl cluster-info\\n# \u67e5\u770b\u5404\u79cd\u7ec4\u4ef6\u7248\u672c\\nkubectl get api-versions\\n# \u67e5\u770b\u7ec4\u4ef6\u72b6\u6001\\nkubectl get componentstatuses\\n```\\n- \u68c0\u67e5\u7cfb\u7edfpod\u72b6\u6001\\n```bash\\n# \u67e5\u770b\u6240\u6709\u547d\u540d\u7a7a\u95f4\u7684pod\u72b6\u6001\\nkubectl get pods -A\\n# \u67e5\u770b\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\u7684pod\u72b6\u6001\\nkubectl get pods -n kube-system\\n# \u5982\u679c\u770b\u5230\u6709\u4e9bpod\u72b6\u6001\u975eRunning\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u9519\\nkubectl describe pod <pod\u540d\u79f0> -n <\u547d\u540d\u7a7a\u95f4>\\n```\\n- \u5c06\u6240\u6709\u8282\u70b9\u6807\u8bb0\u4e3a\u53ef\u8c03\u5ea6\\n```bash\\n# \u5904\u7406\u4ee5\u4e0b\u8b66\u544a\u4f7f\u7528\\n# Warning\xa0 FailedScheduling\xa0 41s (x2 over 6m5s)\xa0 default-scheduler\xa0 0/1 nodes are available: 1 node(s) had untolerated taint {node.kubernetes.io/not-ready: }. no new claims to deallocate, preemption: 0/1 nodes are available: 1 Preemption is not helpful for scheduling.\\nkubectl taint nodes --all node-role.kubernetes.io/master-\\n```\\n>\u5728\u672a\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\u524d\uff0cpods\u548ccoredns\u7684\u72b6\u6001\u53ef\u80fd\u4e0d\u662fReady\u548cRunning\uff0c\u8fd9\u662f\u6b63\u5e38\u7684\uff0c\u5c06\u5728\u4e0b\u4e00\u6b65\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\u540e\u89e3\u51b3\u3002\\n\\n### 6. \u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6calico\\n```bash\\nkubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml\\n# \u63a5\u7740\u4f7f\u7528\u7b2c5\u6b65\u7684\u68c0\u67e5\u7cfb\u7edfpod\u72b6\u6001\u6307\u4ee4\uff0c\u786e\u8ba4\u7f51\u7edc\u63d2\u4ef6\u6b63\u5e38\u5de5\u4f5c\uff0c\u4e14node\u72b6\u6001\u4e3aReady\uff0c\u624d\u7b97\u662f\u96c6\u7fa4\u6b63\u5e38\u5de5\u4f5c\\n```\\n>\u6b64\u5904\u65b0\u624b\u5e38\u9047\u5230\u7684\u95ee\u9898\u662f\u955c\u50cf\u672a\u751f\u6548\uff0ccontainerd\u7684\u64cd\u4f5c\u65b9\u5f0f\u4e0edocker\u6709\u6240\u533a\u522b\uff0c\u63a5\u4e0b\u6765\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528ctr\u547d\u4ee4\u67e5\u770b\u548c\u62c9\u53d6\u955c\u50cf\u3002\\n\\n\u9700\u8981\u6ce8\u610f\u7684\u51e0\u70b9\uff1a\\n- \u5728ctr\u4e2d\u5b58\u5728\u547d\u540d\u7a7a\u95f4\u7684\u533a\u5206\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7684\u547d\u540d\u7a7a\u95f4\u662fdefault\uff0c\u800c**k8s\u4f7f\u7528\u7684\u547d\u540d\u7a7a\u95f4\u662fk8s.io**\uff0c\u6240\u4ee5\u60f3\u8981\u67e5\u770bk8s\u7684\u955c\u50cf\u9700\u8981\u6307\u5b9a-n\u53c2\u6570\\n- ctr\u547d\u4ee4\u4e0d\u4f1a\u81ea\u52a8\u4f7f\u7528\u955c\u50cf\u6e90\uff0c\u9700\u8981\u6307\u5b9a\u2013hosts-dir=/etc/containerd/certs.d\\n- \u60f3\u8981\u81ea\u52a8\u4f7f\u7528\u955c\u50cf\u6e90\uff0c\u53ef\u4ee5\u4f7f\u7528crictl\u547d\u4ee4\u62c9\u53d6\\n- \u5982\u679c\u8981\u786e\u5b9a\u6b64\u547d\u4ee4\u662f\u5426\u771f\u7684\u4f7f\u7528\u4e86\u955c\u50cf\u52a0\u901f\uff0c\u53ef\u4ee5\u589e\u52a0\u2013debug=true\u53c2\u6570\\n- ctr\u547d\u4ee4\u5b58\u5728\u4f7f\u7528image\u7684\u7b80\u5199i\u7684\u4f7f\u7528\u65b9\u5f0f\\n```bash\\n# \u67e5\u770b\u6240\u6709\u955c\u50cf\\nsudo ctr -n <\u955c\u50cf\u5730\u5740> images list\\n# \u62c9\u53d6\u955c\u50cf\\nsudo ctr -n k8s.io images pull <\u955c\u50cf\u5730\u5740>\\n# \u4f8b\u5982\u62c9\u53d6coredns\u7684\u955c\u50cf\\nctr i pull --hosts-dir=/etc/containerd/certs.d docker.io/calico/cni:v3.25.0\\nctr i pull --hosts-dir=/etc/containerd/certs.d registry.k8s.io/sig-storage/csi-provisioner:v3.5.0\\n\\n# \u67e5\u770bk8s.io\u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u6240\u6709\u955c\u50cf\\nsudo ctr -n k8s.io i ls\\n\\n# \u4f7f\u7528crictl\u62c9\u53d6\u955c\u50cf\\nsudo crictl pull <\u955c\u50cf\u5730\u5740>\\n```\\n### 7. \u52a0\u5165worker\u8282\u70b9\\n\u6b63\u5e38\u5b8c\u6210\u524d\u9762\u76841-4\u6b65\u540e\uff0cmaster\u8282\u70b9\u5df2\u7ecf\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u4e86\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u5c06worker\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\uff0cwoker\u8282\u70b9\u76841-4\u6b65\u64cd\u4f5c\u4e0emaster\u8282\u70b9\u76f8\u540c\uff0c\u5b8c\u6210\u540e\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a\\n- \u5728master\u8282\u70b9\u4e0a\u83b7\u53d6\u65b0\u7684token\u4ee5\u53ca\u52a0\u5165\u547d\u4ee4\\n```bash\\nkubeadm token create --print-join-command\\n```\\n- \u5728worker\u8282\u70b9\u4e0a\u6267\u884c\u83b7\u53d6\u5230\u7684\u547d\u4ee4\\n```bash\\nsudo kubeadm join <master\u8282\u70b9IP>:6443 --token <token> --discovery-token-ca-cert-hash sha256:<hash\u503c>\\n# \u4f8bkubeadm join 192.168.0.62:6443 --token 8vm7ed.o0c8hd1sni050ujg --discovery-token-ca-cert-hash sha256:913eb08165815807a28e5b11b3d5c9f16541d4dc9cf36079e1d2ceed54690832\\n```\\n- token\u76f8\u5173\u547d\u4ee4\\n```bash\\n# \u67e5\u770btoken\\nkubeadm token list\\n# \u521b\u5efa\u65b0\u7684token\\nkubeadm token create\\n# \u5220\u9664token\\nkubeadm token delete <token>\\n```\\n\\n### 8. \u68c0\u67e5\u96c6\u7fa4\u72b6\u6001\\n```bash\\nkubectl get nodes\\nkubectl get pods -A\\n```\\n- \u5982\u679c\u9700\u8981\u5220\u9664\u96c6\u7fa4\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\\n```bash\\nsudo kubeadm reset\\nsudo rm -rf $HOME/.kube\\nsudo systemctl disable --now kubelet\\nsudo dnf remove -y kubelet kubeadm kubectl\\nsudo dnf remove -y containerd\\nsudo systemctl disable --now containerd\\n```"}]}}')}}]);